<div class="loot-panel">
  <!-- === GRILLE DES OBJETS AU SOL === -->
  <section class="loot-grid">
    @if (groundItems.length > 0) {
      @for (g of groundItems; track g.id) {
        <div
          class="loot-slot"
          [ngClass]="[selectedItem?.id === g.id ? 'selected' : '', g.item.rarity.toLowerCase()]"
          (click)="selectItem(g)"
        >
          <img [src]="g.item.icon" [alt]="g.item.name" />

          <!-- Affiche la quantité si > 1 -->
          @if (g.count && g.count > 1) {
            <span class="stack-qty">×{{ g.count }}</span>
          }
        </div>
      }
    } @else {
      <p class="empty">Nothing to loot here...</p>
    }
  </section>

  <!-- === DESCRIPTION === -->
  @if (selectedItem) {
    <section class="item-description">
      <div class="item-header">
        <h3 [ngClass]="selectedItem.item.rarity.toLowerCase()">
          {{ selectedItem.item.name }}
        </h3>
        <span class="rarity-label">{{ selectedItem.item.rarity }}</span>
      </div>
      <p class="item-text">{{ selectedItem.item.description }}</p>

      @if (selectedItem.item.effects.length) {
        <ul class="item-effects">
          @for (eff of selectedItem.item.effects; track eff.stat + '-' + eff.value) {
            <li>
              <span class="effect-stat">{{ eff.stat | uppercase }}</span>
              <span class="effect-value">
                {{ eff.value > 0 ? '+' : '' }}{{ eff.value
                }}{{ eff.type === 'percent' ? '%' : '' }}
              </span>
            </li>
          }
        </ul>
      }
    </section>
  }

  <!-- === ACTIONS === -->
  <div class="loot-actions-global">
    <button
      class="action-btn"
      [disabled]="!selectedItem"
      title="Take Selected"
      (click)="selectedItem && takeItem(selectedItem)"
    >
      <img src="assets/ui/action-take.png" alt="Take" />
    </button>

    @if (groundItems.length > 1 || selectedItem?.item?.stackable) {
      <button class="action-btn" title="Take All" (click)="takeAll()">
        <img src="assets/ui/action-takeall.png" alt="Take All" />
      </button>
    }
  </div>

  @if (showQuantitySelector && itemPendingTake) {
    <div class="quantity-popup">
      <div class="popup-inner">
        <h4>Take how many?</h4>
        <input
          type="range"
          min="1"
          [max]="maxQuantity"
          [(ngModel)]="quantityToTake"
        />
        <div class="quantity-display">×{{ quantityToTake }}</div>
        <div class="popup-buttons">
          <button class="confirm-btn" (click)="confirmTake()">Confirm</button>
          <button class="cancel-btn" (click)="showQuantitySelector = false">Cancel</button>
        </div>
      </div>
    </div>
  }

</div>
