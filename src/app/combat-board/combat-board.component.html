<div class="turn-controls">
  <div class="actions-left">
    âš™ï¸ Actions: <strong>{{ actionsRemaining }}</strong> / 2
  </div>

  @if (currentTurn === 'player') {
    <button class="end-turn-btn" (click)="endTurn()">End Turn</button>
  } @else {
    <div class="enemy-turn">ğŸ‘¹ Enemy Turn...</div>
  }
</div>

@if (turnOverlay) {
  <div class="turn-overlay">
    {{ turnOverlay }}
  </div>
}

<div class="board">
  @for (row of grid; track row) {
    <div class="row">
      @for (cell of row; track cell) {
        <div
          class="cell"
          [class.block]="cell.type === 'block'"
          [class.player]="cell.hasPlayer"
          [class.enemy]="cell.hasEnemy"
          [class.walkable]="cell.walkable"
          (click)="onCellClick(cell)"
        >
          @if (cell.hasPlayer) { ğŸ§ }
          @if (cell.hasEnemy) { ğŸ‘¹ }
        </div>
      }
    </div>
  }
</div>

<div class="log-box">
  <h3>ğŸ“œ Combat Log</h3>
  <div class="entries">
    @for (entry of log; track entry.id) {
      <div class="log-entry" [ngClass]="entry.type">{{ entry.msg }}</div>
    }
  </div>
</div>

@if (showResultOverlay && combatResult) {
  <div class="result-overlay">
    <div class="result-card">
      <button class="close" (click)="closeResultOverlay()">âœ•</button>

      @if (combatResult.winner === 'player') {
        <h2 class="victory">ğŸ† Victory!</h2>
      } @else {
        <h2 class="defeat">ğŸ’€ Defeat...</h2>
      }

      <div class="fighters">
        <div class="fighter">
          <img [src]="playerService.portrait" alt="Player" />
          <div>{{ player?.name }}</div>
          <div>â¤ï¸ {{ player?.hp }} / {{ player?.maxHp }}</div>
          <div>ğŸ—¡ï¸ {{ player?.attack ?? 0 }}</div>
          <div>ğŸ›¡ï¸ {{ player?.defense ?? 0 }}</div>
        </div>

        <div class="versus">VS</div>

        <div class="fighter">
          <img [src]="enemy.icon" [alt]="enemy.name" />
          <div>{{ enemy.name }}</div>
          <div>â¤ï¸ {{ enemy.hp }}</div>
          <div>ğŸ—¡ï¸ {{ enemy.attack }}</div>
          <div>ğŸ›¡ï¸ {{ enemy.defense }}</div>
        </div>
      </div>

      @if (combatResult.winner === 'player') {
        <div class="rewards">
          <div>âœ¨ XP Gained: <strong>{{ combatResult.xp }}</strong></div>
          <div>ğŸ’° Gold Earned: <strong>{{ combatResult.gold }}</strong></div>
        </div>
      }
    </div>
  </div>
}
